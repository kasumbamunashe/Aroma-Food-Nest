{% extends "base.html" %}

{% block title %}Booking Calendar - Aroma Food Nest{% endblock %}

{% block content %}
<div class="calendar">
    <div class="calendar-header">
        <h1 class="calendar-title">Booking Calendar</h1>
        <div>
            <a href="{{ url_for('admin') }}" class="btn">Admin Login</a>
            <a href="/" style="margin-left: 1rem;"><i class="fas fa-home"></i> Back to Home</a>
        </div>
    </div>
    
    <div id="calendar-container"></div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const bookedDates = {{ booked_dates|tojson|safe }};
        
        function generateCalendar(year, month) {
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay();
            
            const today = new Date();
            const isCurrentMonth = today.getFullYear() === year && today.getMonth() === month;
            
            let calendarHTML = `
                <div class="calendar-grid">
                    <div class="calendar-day-header">Sun</div>
                    <div class="calendar-day-header">Mon</div>
                    <div class="calendar-day-header">Tue</div>
                    <div class="calendar-day-header">Wed</div>
                    <div class="calendar-day-header">Thu</div>
                    <div class="calendar-day-header">Fri</div>
                    <div class="calendar-day-header">Sat</div>
            `;
            
            // Empty cells for days before the first day of the month
            for (let i = 0; i < startingDay; i++) {
                calendarHTML += `<div class="calendar-day empty"></div>`;
            }
            
            // Days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const isBooked = bookedDates.includes(dateStr);
                const isToday = isCurrentMonth && day === today.getDate();
                
                calendarHTML += `
                    <div class="calendar-day ${isBooked ? 'booked' : ''} ${isToday ? 'today' : ''}" 
                         data-date="${dateStr}">
                        ${day}
                    </div>
                `;
            }
            
            calendarHTML += `</div>`;
            return calendarHTML;
        }
        
        const now = new Date();
        let currentYear = now.getFullYear();
        let currentMonth = now.getMonth();
        
        function renderCalendar() {
            const monthNames = ["January", "February", "March", "April", "May", "June",
                                "July", "August", "September", "October", "November", "December"];
            
            document.getElementById('calendar-container').innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>${monthNames[currentMonth]} ${currentYear}</h2>
                    <div>
                        <button onclick="prevMonth()" class="btn">Previous</button>
                        <button onclick="nextMonth()" class="btn">Next</button>
                    </div>
                </div>
                ${generateCalendar(currentYear, currentMonth)}
            `;
        }
        
        window.prevMonth = function() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
        };
        
        window.nextMonth = function() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderCalendar();
        };
        
        renderCalendar();
    });
</script>
{% endblock %}